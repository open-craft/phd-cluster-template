<!DOCTYPE html><html lang="en" class="no-js"><head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://picasso-harmony-drydock.opencraft.com/instances/deprovisioning/">
      
      
        <link rel="prev" href="../provisioning/">
      
      
        <link rel="next" href="../configuration/">
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Deprovisioning - Launchpad Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../css/opencraft-branding.css">
    
      <link rel="stylesheet" href="https://unpkg.com/mermaid@8/dist/mermaid.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
<style>
    .md-header__button.md-logo img { width: auto !important; }
</style>

  <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"><script src="../../assets/javascripts/glightbox.min.js"></script><style id="glightbox-style">
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color); }
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color); }
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color); }
        </style></head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#instance-deprovisioning" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Launchpad Documentation" class="md-header__button md-logo" aria-label="Launchpad Documentation" data-md-component="logo">
      
  <img src="../../images/opencraft-logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Launchpad Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Deprovisioning
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/open-craft/phd-cluster-template" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"></path></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      

<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
    <div class="md-tabs__inner md-grid">
        <ul class="md-tabs__list">
            <li class="md-tabs__item">
                <a href="https://picasso-harmony-drydock.opencraft.com/" class="md-tabs__link md-tabs__link--active">Launchpad Documentation</a>
            </li>
        </ul>
    </div>
</nav>


      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Launchpad Documentation" class="md-nav__button md-logo" aria-label="Launchpad Documentation" data-md-component="logo">
      
  <img src="../../images/opencraft-logo.svg" alt="logo">

    </a>
    Launchpad Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/open-craft/phd-cluster-template" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"></path></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Introduction
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2">
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Infrastructure
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Infrastructure
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../infrastructure/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../infrastructure/provisioning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Provisioning
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../infrastructure/cluster-repository-setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Cluster Repository Setup
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../infrastructure/deprovisioning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Deprovisioning
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../infrastructure/custom-resources/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Custom Resources
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3">
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Cluster
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Cluster
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cluster/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cluster/authentication/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Authentication
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cluster/configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configuration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cluster/upgrade/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Upgrade
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cluster/backup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Backup
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cluster/restore/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Restore
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cluster/monitoring/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Monitoring
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Instances
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Instances
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../provisioning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Provisioning
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Deprovisioning
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Deprovisioning
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#deprovisioning-steps" class="md-nav__link">
    <span class="md-ellipsis">
      
        Deprovisioning Steps
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Deprovisioning Steps">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      
        Prerequisites
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deprovisioning-process" class="md-nav__link">
    <span class="md-ellipsis">
      
        Deprovisioning Process
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Deprovisioning Process">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-provision-workflow-cleanup" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Provision Workflow Cleanup
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-deprovision-workflow-creation" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Deprovision Workflow Creation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-workflow-execution" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Workflow Execution
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-workflow-completion" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Workflow Completion
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-argocd-application-deletion" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. ArgoCD Application Deletion
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-rbac-cleanup" class="md-nav__link">
    <span class="md-ellipsis">
      
        6. RBAC Cleanup
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-namespace-deletion" class="md-nav__link">
    <span class="md-ellipsis">
      
        7. Namespace Deletion
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8-instance-directory-removal" class="md-nav__link">
    <span class="md-ellipsis">
      
        8. Instance Directory Removal
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#manual-deprovisioning" class="md-nav__link">
    <span class="md-ellipsis">
      
        Manual Deprovisioning
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#force-deletion" class="md-nav__link">
    <span class="md-ellipsis">
      
        Force Deletion
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting" class="md-nav__link">
    <span class="md-ellipsis">
      
        Troubleshooting
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Troubleshooting">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#workflow-failures" class="md-nav__link">
    <span class="md-ellipsis">
      
        Workflow Failures
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#namespace-stuck-in-terminating-state" class="md-nav__link">
    <span class="md-ellipsis">
      
        Namespace Stuck in Terminating State
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#partial-deprovisioning" class="md-nav__link">
    <span class="md-ellipsis">
      
        Partial Deprovisioning
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#database-deletion-issues" class="md-nav__link">
    <span class="md-ellipsis">
      
        Database Deletion Issues
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#storage-bucket-deletion-issues" class="md-nav__link">
    <span class="md-ellipsis">
      
        Storage Bucket Deletion Issues
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#argocd-application-issues" class="md-nav__link">
    <span class="md-ellipsis">
      
        ArgoCD Application Issues
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rbac-cleanup-issues" class="md-nav__link">
    <span class="md-ellipsis">
      
        RBAC Cleanup Issues
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#workflow-timeout" class="md-nav__link">
    <span class="md-ellipsis">
      
        Workflow Timeout
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-recovery" class="md-nav__link">
    <span class="md-ellipsis">
      
        Data Recovery
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getting-help" class="md-nav__link">
    <span class="md-ellipsis">
      
        Getting Help
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#related-documentation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Related Documentation
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#see-also" class="md-nav__link">
    <span class="md-ellipsis">
      
        See Also
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configuration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../docker-images/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Docker Images
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../auto-scaling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Auto-scaling
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tracking-logs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tracking Logs
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../logging/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Logging
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../monitoring/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Monitoring
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../debugging/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Debugging
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5">
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    User Guides
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    User Guides
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guides/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guides/using-aws-waf-and-alb/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Using AWS WAF and ALB
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guides/instance-maintenance-mode/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Instance Maintenance Mode
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guides/setting-up-cron-jobs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Setting Up Cron Jobs
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guides/pull-request-sandboxes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Pull Request Sandboxes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guides/multi-domain-setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Multi-Domain Setup
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guides/migrating-instances-from-grove/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Migrating Instances from Grove
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#deprovisioning-steps" class="md-nav__link">
    <span class="md-ellipsis">
      
        Deprovisioning Steps
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Deprovisioning Steps">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      
        Prerequisites
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deprovisioning-process" class="md-nav__link">
    <span class="md-ellipsis">
      
        Deprovisioning Process
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Deprovisioning Process">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-provision-workflow-cleanup" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Provision Workflow Cleanup
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-deprovision-workflow-creation" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Deprovision Workflow Creation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-workflow-execution" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Workflow Execution
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-workflow-completion" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Workflow Completion
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-argocd-application-deletion" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. ArgoCD Application Deletion
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-rbac-cleanup" class="md-nav__link">
    <span class="md-ellipsis">
      
        6. RBAC Cleanup
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-namespace-deletion" class="md-nav__link">
    <span class="md-ellipsis">
      
        7. Namespace Deletion
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8-instance-directory-removal" class="md-nav__link">
    <span class="md-ellipsis">
      
        8. Instance Directory Removal
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#manual-deprovisioning" class="md-nav__link">
    <span class="md-ellipsis">
      
        Manual Deprovisioning
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#force-deletion" class="md-nav__link">
    <span class="md-ellipsis">
      
        Force Deletion
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting" class="md-nav__link">
    <span class="md-ellipsis">
      
        Troubleshooting
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Troubleshooting">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#workflow-failures" class="md-nav__link">
    <span class="md-ellipsis">
      
        Workflow Failures
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#namespace-stuck-in-terminating-state" class="md-nav__link">
    <span class="md-ellipsis">
      
        Namespace Stuck in Terminating State
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#partial-deprovisioning" class="md-nav__link">
    <span class="md-ellipsis">
      
        Partial Deprovisioning
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#database-deletion-issues" class="md-nav__link">
    <span class="md-ellipsis">
      
        Database Deletion Issues
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#storage-bucket-deletion-issues" class="md-nav__link">
    <span class="md-ellipsis">
      
        Storage Bucket Deletion Issues
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#argocd-application-issues" class="md-nav__link">
    <span class="md-ellipsis">
      
        ArgoCD Application Issues
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rbac-cleanup-issues" class="md-nav__link">
    <span class="md-ellipsis">
      
        RBAC Cleanup Issues
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#workflow-timeout" class="md-nav__link">
    <span class="md-ellipsis">
      
        Workflow Timeout
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-recovery" class="md-nav__link">
    <span class="md-ellipsis">
      
        Data Recovery
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getting-help" class="md-nav__link">
    <span class="md-ellipsis">
      
        Getting Help
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#related-documentation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Related Documentation
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#see-also" class="md-nav__link">
    <span class="md-ellipsis">
      
        See Also
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="instance-deprovisioning">Instance Deprovisioning<a class="headerlink" href="#instance-deprovisioning" title="Permanent link">¶</a></h1>
<p>Deprovisioning removes all resources associated with an Open edX instance when it is no longer needed. This includes deleting databases, storage buckets, Kubernetes namespaces, and cleaning up RBAC policies. The deprovisioning process is automated through Argo Workflows and executed when deleting an instance.</p>
<p>The deprovisioning system handles:</p>
<ul>
<li><strong>MySQL Database</strong>: Removes database and user</li>
<li><strong>MongoDB Database</strong>: Deletes databases and user</li>
<li><strong>Storage Buckets</strong>: Deletes S3-compatible storage buckets and their contents</li>
<li><strong>Kubernetes Resources</strong>: Removes namespaces, RBAC policies, and service accounts</li>
<li><strong>ArgoCD Applications</strong>: Deletes the ArgoCD Application managing the instance</li>
</ul>
<p>All deprovisioning workflows run in parallel. The process is designed to be idempotent, meaning it can be safely retried if it fails partway through.</p>
<h2 id="deprovisioning-steps">Deprovisioning Steps<a class="headerlink" href="#deprovisioning-steps" title="Permanent link">¶</a></h2>
<h3 id="prerequisites">Prerequisites<a class="headerlink" href="#prerequisites" title="Permanent link">¶</a></h3>
<p>Before deprovisioning an instance, ensure:</p>
<ol>
<li><strong>Backup Important Data</strong>: Deprovisioning permanently deletes all instance data. Ensure you have backups if needed</li>
<li><strong>Database Access</strong>: Admin credentials for MySQL and MongoDB servers</li>
<li><strong>Storage Credentials</strong>: Access keys for S3-compatible storage</li>
</ol>
<h3 id="deprovisioning-process">Deprovisioning Process<a class="headerlink" href="#deprovisioning-process" title="Permanent link">¶</a></h3>
<p>The deprovisioning process is automatically executed when deleting an instance using the <code>phd_delete_instance</code> command or the GitHub Actions workflow. The process follows these steps:</p>
<h4 id="1-provision-workflow-cleanup">1. Provision Workflow Cleanup<a class="headerlink" href="#1-provision-workflow-cleanup" title="Permanent link">¶</a></h4>
<p>Any remaining provision workflows are deleted to clean up resources.</p>
<h4 id="2-deprovision-workflow-creation">2. Deprovision Workflow Creation<a class="headerlink" href="#2-deprovision-workflow-creation" title="Permanent link">¶</a></h4>
<p>Three deprovision workflows are created in parallel:</p>
<ul>
<li><strong>MySQL Deprovision Workflow</strong>: Removes the MySQL database and user</li>
<li><strong>MongoDB Deprovision Workflow</strong>: Deletes MongoDB databases and user</li>
<li><strong>Storage Deprovision Workflow</strong>: Deletes the storage bucket and its contents</li>
</ul>
<p>Each workflow is parameterized with instance-specific configuration values extracted from the instance configuration file.</p>
<h4 id="3-workflow-execution">3. Workflow Execution<a class="headerlink" href="#3-workflow-execution" title="Permanent link">¶</a></h4>
<p>The workflows execute the following operations:</p>
<p><strong>MySQL Deprovisioning</strong>:
- Connects to the MySQL server using admin credentials
- Drops the database specified in the instance configuration
- Removes the user associated with the instance
- Cleans up any related permissions</p>
<p><strong>MongoDB Deprovisioning</strong>:
- Detects the MongoDB provider
- Drops the main database and forum database
- Removes the user associated with the instance
- For API-based providers, uses the provider's API to manage user deletion</p>
<p><strong>Storage Deprovisioning</strong>:
- Deletes all objects in the storage bucket
- Removes the storage bucket itself
- Uses force deletion to ensure the bucket is removed even if it contains objects</p>
<h4 id="4-workflow-completion">4. Workflow Completion<a class="headerlink" href="#4-workflow-completion" title="Permanent link">¶</a></h4>
<p>The system waits for all workflows to complete (default timeout: 300 seconds). Unlike provisioning, deprovisioning workflows that fail are logged as warnings but do not abort the entire process, as some resources may have already been deleted.</p>
<h4 id="5-argocd-application-deletion">5. ArgoCD Application Deletion<a class="headerlink" href="#5-argocd-application-deletion" title="Permanent link">¶</a></h4>
<p>The ArgoCD Application managing the instance is deleted. This stops any ongoing deployments and removes the application from ArgoCD.</p>
<h4 id="6-rbac-cleanup">6. RBAC Cleanup<a class="headerlink" href="#6-rbac-cleanup" title="Permanent link">¶</a></h4>
<p>Cluster-level RBAC resources are removed:
- ClusterRole and ClusterRoleBinding for the instance
- Any other instance-specific RBAC policies</p>
<h4 id="7-namespace-deletion">7. Namespace Deletion<a class="headerlink" href="#7-namespace-deletion" title="Permanent link">¶</a></h4>
<p>The Kubernetes namespace containing all instance resources is deleted. This operation has a timeout of 300 seconds and will remove all remaining resources in the namespace.</p>
<h4 id="8-instance-directory-removal">8. Instance Directory Removal<a class="headerlink" href="#8-instance-directory-removal" title="Permanent link">¶</a></h4>
<p>The local instance configuration directory is removed from the cluster repository.</p>
<h3 id="manual-deprovisioning">Manual Deprovisioning<a class="headerlink" href="#manual-deprovisioning" title="Permanent link">¶</a></h3>
<p>If you need to manually trigger deprovisioning workflows, you can use <code>kubectl</code>:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Apply a deprovision workflow manually</span>
kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>&lt;workflow-manifest-url&gt;<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--namespace<span class="w"> </span>&lt;instance-name&gt;

<span class="c1"># Monitor workflow status</span>
kubectl<span class="w"> </span>get<span class="w"> </span>workflows<span class="w"> </span>-n<span class="w"> </span>&lt;instance-name&gt;

<span class="c1"># View workflow logs</span>
kubectl<span class="w"> </span>logs<span class="w"> </span>-n<span class="w"> </span>&lt;instance-name&gt;<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>workflow/&lt;workflow-name&gt;
</code></pre></div>
<h3 id="force-deletion">Force Deletion<a class="headerlink" href="#force-deletion" title="Permanent link">¶</a></h3>
<p>If normal deletion fails, you can use the <code>--force</code> flag to skip confirmation prompts:</p>
<div class="highlight"><pre><span></span><code>phd_delete_instance<span class="w"> </span>&lt;instance-name&gt;<span class="w"> </span>--force
</code></pre></div>
<p><strong>Warning</strong>: Force deletion bypasses safety checks and should only be used when you are certain you want to delete the instance.</p>
<h2 id="troubleshooting">Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permanent link">¶</a></h2>
<h3 id="workflow-failures">Workflow Failures<a class="headerlink" href="#workflow-failures" title="Permanent link">¶</a></h3>
<p>If a deprovisioning workflow fails, check the workflow status and logs:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Check workflow status</span>
kubectl<span class="w"> </span>get<span class="w"> </span>workflows<span class="w"> </span>-n<span class="w"> </span>&lt;instance-name&gt;

<span class="c1"># View detailed workflow information</span>
kubectl<span class="w"> </span>describe<span class="w"> </span>workflow<span class="w"> </span>&lt;workflow-name&gt;<span class="w"> </span>-n<span class="w"> </span>&lt;instance-name&gt;

<span class="c1"># View workflow logs</span>
kubectl<span class="w"> </span>logs<span class="w"> </span>-n<span class="w"> </span>&lt;instance-name&gt;<span class="w"> </span>workflow/&lt;workflow-name&gt;
</code></pre></div>
<p><strong>Common Issues</strong>:</p>
<ul>
<li><strong>Database Connection Failures</strong>: Verify that database host, port, and credentials are still valid</li>
<li><strong>Resource Already Deleted</strong>: Some workflows may fail if resources were already deleted. This is expected and typically safe to ignore</li>
<li><strong>Permission Errors</strong>: Ensure admin credentials have sufficient privileges to delete databases and users</li>
<li><strong>Provider API Errors</strong>: For MongoDB Atlas or DigitalOcean, verify API credentials are still valid</li>
</ul>
<h3 id="namespace-stuck-in-terminating-state">Namespace Stuck in Terminating State<a class="headerlink" href="#namespace-stuck-in-terminating-state" title="Permanent link">¶</a></h3>
<p>If a namespace is stuck in the "Terminating" state:</p>
<ol>
<li>
<p><strong>Check for Finalizers</strong>: Some resources may have finalizers preventing deletion
   </p><div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>get<span class="w"> </span>namespace<span class="w"> </span>&lt;instance-name&gt;<span class="w"> </span>-o<span class="w"> </span>yaml
</code></pre></div><p></p>
</li>
<li>
<p><strong>Force Remove Finalizers</strong>: If safe, you can manually remove finalizers:
   </p><div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>patch<span class="w"> </span>namespace<span class="w"> </span>&lt;instance-name&gt;<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-p<span class="w"> </span><span class="s1">'{"metadata":{"finalizers":[]}}'</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--type<span class="o">=</span>merge
</code></pre></div><p></p>
</li>
<li>
<p><strong>Check Remaining Resources</strong>: List resources that may be preventing deletion:
   </p><div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>api-resources<span class="w"> </span>--verbs<span class="o">=</span>list<span class="w"> </span>--namespaced<span class="w"> </span>-o<span class="w"> </span>name<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>xargs<span class="w"> </span>-n<span class="w"> </span><span class="m">1</span><span class="w"> </span>kubectl<span class="w"> </span>get<span class="w"> </span>--show-kind<span class="w"> </span>--ignore-not-found<span class="w"> </span>-n<span class="w"> </span>&lt;instance-name&gt;
</code></pre></div><p></p>
</li>
</ol>
<h3 id="partial-deprovisioning">Partial Deprovisioning<a class="headerlink" href="#partial-deprovisioning" title="Permanent link">¶</a></h3>
<p>If deprovisioning partially succeeds (some resources deleted, others remain):</p>
<ol>
<li><strong>Identify Remaining Resources</strong>: Check what resources still exist</li>
<li><strong>Manual Cleanup</strong>: Manually delete remaining resources if safe to do so</li>
<li><strong>Retry Workflows</strong>: Re-run the deprovision workflows for failed components</li>
</ol>
<h3 id="database-deletion-issues">Database Deletion Issues<a class="headerlink" href="#database-deletion-issues" title="Permanent link">¶</a></h3>
<p>If databases cannot be deleted:</p>
<ul>
<li>
<p><strong>MySQL</strong>: Ensure no active connections to the database. You may need to manually drop the database:
  </p><div class="highlight"><pre><span></span><code><span class="k">DROP</span><span class="w"> </span><span class="k">DATABASE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="o">&lt;</span><span class="k">database</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span><span class="p">;</span>
<span class="k">DROP</span><span class="w"> </span><span class="k">USER</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="s1">'&lt;username&gt;'</span><span class="o">@</span><span class="s1">'%'</span><span class="p">;</span>
</code></pre></div><p></p>
</li>
<li>
<p><strong>MongoDB</strong>: For API-based providers, check provider-specific limitations. Some providers may require manual cleanup through their web interface</p>
</li>
</ul>
<h3 id="storage-bucket-deletion-issues">Storage Bucket Deletion Issues<a class="headerlink" href="#storage-bucket-deletion-issues" title="Permanent link">¶</a></h3>
<p>If storage buckets cannot be deleted:</p>
<ul>
<li><strong>Non-Empty Buckets</strong>: Ensure all objects are deleted before deleting the bucket. The deprovision workflow uses force deletion, but some providers may have additional requirements</li>
<li><strong>Bucket Policies</strong>: Check if bucket policies or lifecycle rules are preventing deletion</li>
<li><strong>Manual Cleanup</strong>: You may need to manually delete the bucket through the provider's console if the workflow fails</li>
</ul>
<h3 id="argocd-application-issues">ArgoCD Application Issues<a class="headerlink" href="#argocd-application-issues" title="Permanent link">¶</a></h3>
<p>If the ArgoCD Application cannot be deleted:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Check application status</span>
kubectl<span class="w"> </span>get<span class="w"> </span>application<span class="w"> </span>-n<span class="w"> </span>argocd<span class="w"> </span>&lt;application-name&gt;

<span class="c1"># Force delete if necessary</span>
kubectl<span class="w"> </span>delete<span class="w"> </span>application<span class="w"> </span>&lt;application-name&gt;<span class="w"> </span>-n<span class="w"> </span>argocd<span class="w"> </span>--force<span class="w"> </span>--grace-period<span class="o">=</span><span class="m">0</span>
</code></pre></div>
<h3 id="rbac-cleanup-issues">RBAC Cleanup Issues<a class="headerlink" href="#rbac-cleanup-issues" title="Permanent link">¶</a></h3>
<p>If RBAC resources cannot be deleted:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># List remaining RBAC resources</span>
kubectl<span class="w"> </span>get<span class="w"> </span>clusterrole<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>&lt;instance-name&gt;
kubectl<span class="w"> </span>get<span class="w"> </span>clusterrolebinding<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>&lt;instance-name&gt;

<span class="c1"># Manually delete if needed</span>
kubectl<span class="w"> </span>delete<span class="w"> </span>clusterrole<span class="w"> </span>&lt;instance-name&gt;-workflows
kubectl<span class="w"> </span>delete<span class="w"> </span>clusterrolebinding<span class="w"> </span>&lt;instance-name&gt;-binding
</code></pre></div>
<h3 id="workflow-timeout">Workflow Timeout<a class="headerlink" href="#workflow-timeout" title="Permanent link">¶</a></h3>
<p>If workflows are timing out:</p>
<ol>
<li><strong>Check Resource State</strong>: Verify that resources are in a state that allows deletion</li>
<li><strong>Increase Timeout</strong>: The default timeout is 300 seconds. For large databases or buckets with many objects, this may need to be increased</li>
<li><strong>Manual Intervention</strong>: If workflows consistently timeout, consider manually deleting resources and then cleaning up the workflows</li>
</ol>
<h3 id="data-recovery">Data Recovery<a class="headerlink" href="#data-recovery" title="Permanent link">¶</a></h3>
<p>If you need to recover data after deprovisioning:</p>
<ul>
<li><strong>Backups</strong>: Check if backups were created before deprovisioning (if Velero backup solutions are configured)</li>
<li><strong>Database Snapshots</strong>: Some database providers maintain snapshots that can be restored</li>
<li><strong>Storage Buckets</strong>: If the bucket was not force-deleted, objects may still be recoverable depending on the provider's retention policies</li>
</ul>
<p><strong>Note</strong>: Once deprovisioning is complete, data recovery may not be possible. Always ensure backups are created before deprovisioning production instances.</p>
<h3 id="getting-help">Getting Help<a class="headerlink" href="#getting-help" title="Permanent link">¶</a></h3>
<p>If deprovisioning continues to fail:</p>
<ol>
<li><strong>Collect Logs</strong>: Gather workflow logs, Kubernetes events, and any error messages</li>
<li><strong>Check Resource State</strong>: Verify the current state of databases, storage, and Kubernetes resources</li>
<li><strong>Review Configuration</strong>: Ensure all environment variables and credentials are still valid</li>
<li><strong>Manual Cleanup</strong>: As a last resort, manually clean up remaining resources following provider-specific procedures</li>
</ol>
<h2 id="related-documentation">Related Documentation<a class="headerlink" href="#related-documentation" title="Permanent link">¶</a></h2>
<ul>
<li><a href="../">Instances Overview</a> -  Instance lifecycle</li>
<li><a href="../provisioning/">Provisioning</a> -  What gets created for an instance</li>
<li><a href="../../infrastructure/deprovisioning/">Infrastructure Deprovisioning</a> -  Cluster-level deprovisioning</li>
<li><a href="../../cluster/backup/">Cluster Backup</a> -  Backing up before deprovisioning</li>
</ul>
<h2 id="see-also">See Also<a class="headerlink" href="#see-also" title="Permanent link">¶</a></h2>
<ul>
<li><a href="../configuration/">Configuration</a> -  Instance config and credentials</li>
<li><a href="../../infrastructure/">Infrastructure Overview</a> -  Argo Workflows and resources</li>
<li><a href="../../cluster/restore/">Cluster Restore</a> -  Restore procedures</li>
<li><a href="../debugging/">Debugging</a> -  Troubleshooting deprovisioning issues</li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="https://unpkg.com/mermaid@8/dist/mermaid.min.js"></script>
      
    
  
<script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(()=>{ lightbox.reload(); });
</script></body></html>