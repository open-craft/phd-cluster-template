<!DOCTYPE html><html lang="en" class="no-js"><head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://picasso-harmony-drydock.opencraft.com/infrastructure/deprovisioning/">
      
      
        <link rel="prev" href="../cluster-repository-setup/">
      
      
        <link rel="next" href="../custom-resources/">
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Deprovisioning - Launchpad Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../css/opencraft-branding.css">
    
      <link rel="stylesheet" href="https://unpkg.com/mermaid@8/dist/mermaid.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
<style>
    .md-header__button.md-logo img { width: auto !important; }
</style>

  <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"><script src="../../assets/javascripts/glightbox.min.js"></script><style id="glightbox-style">
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color); }
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color); }
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color); }
        </style></head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#infrastructure-deprovisioning" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Launchpad Documentation" class="md-header__button md-logo" aria-label="Launchpad Documentation" data-md-component="logo">
      
  <img src="../../images/opencraft-logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Launchpad Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Deprovisioning
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/open-craft/phd-cluster-template" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"></path></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      

<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
    <div class="md-tabs__inner md-grid">
        <ul class="md-tabs__list">
            <li class="md-tabs__item">
                <a href="https://picasso-harmony-drydock.opencraft.com/" class="md-tabs__link md-tabs__link--active">Launchpad Documentation</a>
            </li>
        </ul>
    </div>
</nav>


      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Launchpad Documentation" class="md-nav__button md-logo" aria-label="Launchpad Documentation" data-md-component="logo">
      
  <img src="../../images/opencraft-logo.svg" alt="logo">

    </a>
    Launchpad Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/open-craft/phd-cluster-template" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"></path></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Introduction
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Infrastructure
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Infrastructure
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../provisioning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Provisioning
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cluster-repository-setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Cluster Repository Setup
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Deprovisioning
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Deprovisioning
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      
        Prerequisites
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deprovisioning-steps" class="md-nav__link">
    <span class="md-ellipsis">
      
        Deprovisioning Steps
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Deprovisioning Steps">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-verify-no-active-instances" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 1: Verify No Active Instances
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-uninstall-argocd-and-argo-workflows" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 2: Uninstall ArgoCD and Argo Workflows
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-clean-up-remaining-resources" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 3: Clean Up Remaining Resources
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-4-destroy-infrastructure" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 4: Destroy Infrastructure
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-5-clean-up-local-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 5: Clean Up Local Configuration
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting" class="md-nav__link">
    <span class="md-ellipsis">
      
        Troubleshooting
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Troubleshooting">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#namespace-stuck-in-terminating-state" class="md-nav__link">
    <span class="md-ellipsis">
      
        Namespace Stuck in Terminating State
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#infrastructure-destruction-issues" class="md-nav__link">
    <span class="md-ellipsis">
      
        Infrastructure Destruction Issues
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kubernetes-cluster-access-issues" class="md-nav__link">
    <span class="md-ellipsis">
      
        Kubernetes Cluster Access Issues
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#state-file-issues" class="md-nav__link">
    <span class="md-ellipsis">
      
        State File Issues
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#partial-destruction" class="md-nav__link">
    <span class="md-ellipsis">
      
        Partial Destruction
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-recovery" class="md-nav__link">
    <span class="md-ellipsis">
      
        Data Recovery
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      
        Best Practices
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Best Practices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#before-deprovisioning" class="md-nav__link">
    <span class="md-ellipsis">
      
        Before Deprovisioning
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#during-deprovisioning" class="md-nav__link">
    <span class="md-ellipsis">
      
        During Deprovisioning
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#after-deprovisioning" class="md-nav__link">
    <span class="md-ellipsis">
      
        After Deprovisioning
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#next-steps" class="md-nav__link">
    <span class="md-ellipsis">
      
        Next Steps
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#related-documentation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Related Documentation
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#see-also" class="md-nav__link">
    <span class="md-ellipsis">
      
        See Also
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../custom-resources/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Custom Resources
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3">
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Cluster
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Cluster
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cluster/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cluster/authentication/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Authentication
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cluster/configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configuration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cluster/upgrade/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Upgrade
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cluster/backup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Backup
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cluster/restore/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Restore
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cluster/monitoring/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Monitoring
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4">
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Instances
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Instances
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../instances/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../instances/provisioning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Provisioning
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../instances/deprovisioning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Deprovisioning
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../instances/configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configuration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../instances/docker-images/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Docker Images
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../instances/auto-scaling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Auto-scaling
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../instances/tracking-logs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tracking Logs
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../instances/logging/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Logging
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../instances/monitoring/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Monitoring
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../instances/debugging/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Debugging
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5">
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    User Guides
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    User Guides
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guides/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guides/using-aws-waf-and-alb/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Using AWS WAF and ALB
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guides/instance-maintenance-mode/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Instance Maintenance Mode
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guides/setting-up-cron-jobs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Setting Up Cron Jobs
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guides/pull-request-sandboxes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Pull Request Sandboxes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guides/multi-domain-setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Multi-Domain Setup
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guides/migrating-instances-from-grove/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Migrating Instances from Grove
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      
        Prerequisites
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deprovisioning-steps" class="md-nav__link">
    <span class="md-ellipsis">
      
        Deprovisioning Steps
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Deprovisioning Steps">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-verify-no-active-instances" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 1: Verify No Active Instances
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-uninstall-argocd-and-argo-workflows" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 2: Uninstall ArgoCD and Argo Workflows
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-clean-up-remaining-resources" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 3: Clean Up Remaining Resources
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-4-destroy-infrastructure" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 4: Destroy Infrastructure
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-5-clean-up-local-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 5: Clean Up Local Configuration
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting" class="md-nav__link">
    <span class="md-ellipsis">
      
        Troubleshooting
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Troubleshooting">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#namespace-stuck-in-terminating-state" class="md-nav__link">
    <span class="md-ellipsis">
      
        Namespace Stuck in Terminating State
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#infrastructure-destruction-issues" class="md-nav__link">
    <span class="md-ellipsis">
      
        Infrastructure Destruction Issues
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kubernetes-cluster-access-issues" class="md-nav__link">
    <span class="md-ellipsis">
      
        Kubernetes Cluster Access Issues
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#state-file-issues" class="md-nav__link">
    <span class="md-ellipsis">
      
        State File Issues
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#partial-destruction" class="md-nav__link">
    <span class="md-ellipsis">
      
        Partial Destruction
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-recovery" class="md-nav__link">
    <span class="md-ellipsis">
      
        Data Recovery
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      
        Best Practices
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Best Practices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#before-deprovisioning" class="md-nav__link">
    <span class="md-ellipsis">
      
        Before Deprovisioning
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#during-deprovisioning" class="md-nav__link">
    <span class="md-ellipsis">
      
        During Deprovisioning
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#after-deprovisioning" class="md-nav__link">
    <span class="md-ellipsis">
      
        After Deprovisioning
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#next-steps" class="md-nav__link">
    <span class="md-ellipsis">
      
        Next Steps
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#related-documentation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Related Documentation
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#see-also" class="md-nav__link">
    <span class="md-ellipsis">
      
        See Also
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="infrastructure-deprovisioning">Infrastructure Deprovisioning<a class="headerlink" href="#infrastructure-deprovisioning" title="Permanent link">¶</a></h1>
<p>Deprovisioning is removing the Kubernetes cluster and all associated resources when they are no longer needed. This includes uninstalling GitOps tools (ArgoCD and Argo Workflows), destroying infrastructure resources, and cleaning up configuration files.</p>
<p>The deprovisioning process should be performed in reverse order of provisioning:</p>
<ol>
<li><strong>Remove All Instances</strong>: Delete all Open edX instances first</li>
<li><strong>Uninstall GitOps Tools</strong>: Remove ArgoCD and Argo Workflows</li>
<li><strong>Destroy Infrastructure</strong>: Destroy Kubernetes cluster and supporting resources using Terraform/OpenTofu</li>
<li><strong>Clean Up Configuration</strong>: Remove local cluster configuration files</li>
</ol>
<p><strong>Warning</strong>: Deprovisioning is a destructive operation that permanently removes all resources and data. Ensure you have backups of any important data before proceeding.</p>
<h2 id="prerequisites">Prerequisites<a class="headerlink" href="#prerequisites" title="Permanent link">¶</a></h2>
<p>Before deprovisioning infrastructure, ensure:</p>
<ul>
<li><strong>All Instances Removed</strong>: All Open edX instances have been deleted</li>
<li><strong>Backups Verified</strong>: Any required backups have been created and verified</li>
<li><strong>Access Credentials</strong>: Valid credentials for cloud provider and Kubernetes cluster</li>
<li><strong>Terraform/OpenTofu State</strong>: Access to Terraform state file (for infrastructure destruction)</li>
</ul>
<h2 id="deprovisioning-steps">Deprovisioning Steps<a class="headerlink" href="#deprovisioning-steps" title="Permanent link">¶</a></h2>
<h3 id="step-1-verify-no-active-instances">Step 1: Verify No Active Instances<a class="headerlink" href="#step-1-verify-no-active-instances" title="Permanent link">¶</a></h3>
<p>Before deprovisioning infrastructure, ensure all Open edX instances have been removed:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># List all namespaces (excluding system namespaces)</span>
kubectl<span class="w"> </span>get<span class="w"> </span>namespaces<span class="w"> </span>--field-selector<span class="w"> </span>metadata.name!<span class="o">=</span>kube-system,metadata.name!<span class="o">=</span>kube-public,metadata.name!<span class="o">=</span>kube-node-lease

<span class="c1"># Check for ArgoCD applications</span>
kubectl<span class="w"> </span>get<span class="w"> </span>applications<span class="w"> </span>-n<span class="w"> </span>argocd

<span class="c1"># Verify no instance namespaces exist</span>
kubectl<span class="w"> </span>get<span class="w"> </span>namespaces<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-v<span class="w"> </span><span class="s2">"kube-\|argocd\|argo\|default"</span>
</code></pre></div>
<p>If any instances remain, delete them first using <code>phd_delete_instance</code>, the GitHub Actions workflow, or manually.</p>
<h3 id="step-2-uninstall-argocd-and-argo-workflows">Step 2: Uninstall ArgoCD and Argo Workflows<a class="headerlink" href="#step-2-uninstall-argocd-and-argo-workflows" title="Permanent link">¶</a></h3>
<p>Remove the GitOps tools from the cluster. While there's no dedicated uninstall command, you can remove them manually:</p>
<p><strong>Uninstall ArgoCD</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Delete ArgoCD namespace (this removes all ArgoCD resources)</span>
kubectl<span class="w"> </span>delete<span class="w"> </span>namespace<span class="w"> </span>argocd

<span class="c1"># Wait for namespace to be fully deleted</span>
kubectl<span class="w"> </span><span class="nb">wait</span><span class="w"> </span>--for<span class="o">=</span>delete<span class="w"> </span>namespace/argocd<span class="w"> </span>--timeout<span class="o">=</span>300s
</code></pre></div>
<p><strong>Uninstall Argo Workflows</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Delete workflow templates first</span>
kubectl<span class="w"> </span>delete<span class="w"> </span>clusterworkflowtemplates<span class="w"> </span>--all

<span class="c1"># Delete Argo Workflows namespace</span>
kubectl<span class="w"> </span>delete<span class="w"> </span>namespace<span class="w"> </span>argo

<span class="c1"># Wait for namespace to be fully deleted</span>
kubectl<span class="w"> </span><span class="nb">wait</span><span class="w"> </span>--for<span class="o">=</span>delete<span class="w"> </span>namespace/argo<span class="w"> </span>--timeout<span class="o">=</span>300s
</code></pre></div>
<p><strong>Verify Removal</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Verify namespaces are gone</span>
kubectl<span class="w"> </span>get<span class="w"> </span>namespace<span class="w"> </span>argocd<span class="w">  </span><span class="c1"># Should return "not found"</span>
kubectl<span class="w"> </span>get<span class="w"> </span>namespace<span class="w"> </span>argo<span class="w">    </span><span class="c1"># Should return "not found"</span>

<span class="c1"># Verify no ArgoCD resources remain</span>
kubectl<span class="w"> </span>get<span class="w"> </span>all<span class="w"> </span>-n<span class="w"> </span>argocd<span class="w">  </span><span class="c1"># Should return "not found"</span>

<span class="c1"># Verify no Argo Workflows resources remain</span>
kubectl<span class="w"> </span>get<span class="w"> </span>all<span class="w"> </span>-n<span class="w"> </span>argo<span class="w">  </span><span class="c1"># Should return "not found"</span>
</code></pre></div>
<p><strong>Note</strong>: If namespaces are stuck in "Terminating" state, see the <a href="#namespace-stuck-in-terminating-state">Troubleshooting</a> section.</p>
<h3 id="step-3-clean-up-remaining-resources">Step 3: Clean Up Remaining Resources<a class="headerlink" href="#step-3-clean-up-remaining-resources" title="Permanent link">¶</a></h3>
<p>Remove any remaining resources that might prevent infrastructure destruction:</p>
<p>We are listing the PVs and PVCs in order to keep a record of what was used by the cluster. In case the cluster deletion goes sideways, we have easier job identifying dangling resources.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># List persistent volumes</span>
kubectl<span class="w"> </span>get<span class="w"> </span>pv

<span class="c1"># List persistent volume claims</span>
kubectl<span class="w"> </span>get<span class="w"> </span>pvc<span class="w"> </span>--all-namespaces

<span class="c1"># List storage classes</span>
kubectl<span class="w"> </span>get<span class="w"> </span>storageclass

<span class="c1"># List custom resource definitions</span>
kubectl<span class="w"> </span>get<span class="w"> </span>crd
</code></pre></div>
<p><strong>Delete selective resources</strong> (replace <code>&lt;name&gt;</code> and <code>&lt;namespace&gt;</code> with actual values):</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Delete a persistent volume claim (typically required before deleting its bound PV)</span>
kubectl<span class="w"> </span>delete<span class="w"> </span>pvc<span class="w"> </span>&lt;pvc-name&gt;<span class="w"> </span>-n<span class="w"> </span>&lt;namespace&gt;

<span class="c1"># Delete a persistent volume</span>
kubectl<span class="w"> </span>delete<span class="w"> </span>pv<span class="w"> </span>&lt;pv-name&gt;

<span class="c1"># Delete a storage class (only if not in use)</span>
kubectl<span class="w"> </span>delete<span class="w"> </span>storageclass<span class="w"> </span>&lt;storageclass-name&gt;

<span class="c1"># Delete a custom resource definition (removes the CRD and all instances of that resource)</span>
kubectl<span class="w"> </span>delete<span class="w"> </span>crd<span class="w"> </span>&lt;crd-name&gt;
</code></pre></div>
<p><strong>Remove Custom Resources</strong> (if needed):</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Remove ArgoCD CRDs (if not removed with namespace)</span>
kubectl<span class="w"> </span>delete<span class="w"> </span>crd<span class="w"> </span>applications.argoproj.io
kubectl<span class="w"> </span>delete<span class="w"> </span>crd<span class="w"> </span>application<span class="w"> </span>sets.argoproj.io
kubectl<span class="w"> </span>delete<span class="w"> </span>crd<span class="w"> </span>appprojects.argoproj.io

<span class="c1"># Remove Argo Workflows CRDs (if not removed with namespace)</span>
kubectl<span class="w"> </span>delete<span class="w"> </span>crd<span class="w"> </span>clusterworkflowtemplates.argoproj.io
kubectl<span class="w"> </span>delete<span class="w"> </span>crd<span class="w"> </span>cronworkflows.argoproj.io
kubectl<span class="w"> </span>delete<span class="w"> </span>crd<span class="w"> </span>workflows.argoproj.io
kubectl<span class="w"> </span>delete<span class="w"> </span>crd<span class="w"> </span>workflowtemplates.argoproj.io
kubectl<span class="w"> </span>delete<span class="w"> </span>crd<span class="w"> </span>workfloweventbindings.argoproj.io
</code></pre></div>
<h3 id="step-4-destroy-infrastructure">Step 4: Destroy Infrastructure<a class="headerlink" href="#step-4-destroy-infrastructure" title="Permanent link">¶</a></h3>
<p>Destroy the infrastructure using Terraform or OpenTofu. This will remove the Kubernetes cluster and all associated cloud resources.</p>
<p><strong>Navigate to Infrastructure Directory</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>phd-production-cluster/infrastructure-aws<span class="w">  </span><span class="c1"># or infrastructure-digitalocean</span>
</code></pre></div>
<p><strong>Configure Backend Credentials</strong>:</p>
<p>See the <a href="../provisioning/">provisioning</a> guide on how to setup the backend credentials.</p>
<p><strong>Review Destruction Plan</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Review what will be destroyed</span>
tofu<span class="w"> </span>plan<span class="w"> </span>-destroy
</code></pre></div>
<p><strong>Destroy Infrastructure</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Destroy all infrastructure</span>
tofu<span class="w"> </span>destroy
</code></pre></div>
<p><strong>What Gets Destroyed</strong>:</p>
<ul>
<li><strong>Kubernetes Cluster</strong>: EKS or DOKS cluster</li>
<li><strong>Node Groups</strong>: All worker nodes</li>
<li><strong>Databases</strong>: Managed MySQL and MongoDB instances</li>
<li><strong>Storage</strong>: S3 buckets or DigitalOcean Spaces</li>
<li><strong>Networking</strong>: Load balancers, VPC resources (depending on configuration)</li>
<li><strong>Other Resources</strong>: Any other resources created by Terraform modules</li>
</ul>
<p><strong>Important Notes</strong>:</p>
<ul>
<li>Some resources may take time to destroy (especially databases and storage)</li>
<li>External databases and storage will be destroyed</li>
<li>Review the destruction plan carefully before confirming</li>
</ul>
<h3 id="step-5-clean-up-local-configuration">Step 5: Clean Up Local Configuration<a class="headerlink" href="#step-5-clean-up-local-configuration" title="Permanent link">¶</a></h3>
<p>After infrastructure is destroyed, you can optionally remove local cluster configuration:</p>
<p><strong>Remove Cluster Directory</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Navigate to parent directory</span>
<span class="nb">cd</span><span class="w"> </span>../..

<span class="c1"># Remove cluster configuration directory</span>
rm<span class="w"> </span>-rf<span class="w"> </span>phd-production-cluster
</code></pre></div>
<p><strong>Remove kubeconfig</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Remove cluster-specific kubeconfig</span>
rm<span class="w"> </span>~/.kube/config-cluster

<span class="c1"># Or remove from main kubeconfig if merged</span>
kubectl<span class="w"> </span>config<span class="w"> </span>delete-context<span class="w"> </span>&lt;cluster-context-name&gt;
kubectl<span class="w"> </span>config<span class="w"> </span>delete-cluster<span class="w"> </span>&lt;cluster-name&gt;
</code></pre></div>
<p><strong>Note</strong>: You may want to keep the cluster configuration directory for reference or to recreate the cluster later.</p>
<h2 id="troubleshooting">Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permanent link">¶</a></h2>
<h3 id="namespace-stuck-in-terminating-state">Namespace Stuck in Terminating State<a class="headerlink" href="#namespace-stuck-in-terminating-state" title="Permanent link">¶</a></h3>
<p>If ArgoCD or Argo Workflows namespaces are stuck in "Terminating" state:</p>
<p><strong>Check for Blocking Resources</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># List all resources in the namespace</span>
kubectl<span class="w"> </span>api-resources<span class="w"> </span>--verbs<span class="o">=</span>list<span class="w"> </span>--namespaced<span class="w"> </span>-o<span class="w"> </span>name<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>xargs<span class="w"> </span>-n<span class="w"> </span><span class="m">1</span><span class="w"> </span>kubectl<span class="w"> </span>get<span class="w"> </span>--show-kind<span class="w"> </span>--ignore-not-found<span class="w"> </span>-n<span class="w"> </span>argocd

<span class="c1"># Check for finalizers</span>
kubectl<span class="w"> </span>get<span class="w"> </span>namespace<span class="w"> </span>argocd<span class="w"> </span>-o<span class="w"> </span>yaml<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>finalizers
</code></pre></div>
<p><strong>Force Remove Finalizers</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Edit namespace to remove finalizers</span>
kubectl<span class="w"> </span>patch<span class="w"> </span>namespace<span class="w"> </span>argocd<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-p<span class="w"> </span><span class="s1">'{"metadata":{"finalizers":[]}}'</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--type<span class="o">=</span>merge
</code></pre></div>
<p><strong>Force Delete Resources</strong>:</p>
<p>If specific resources are blocking deletion:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Find resources with finalizers</span>
kubectl<span class="w"> </span>get<span class="w"> </span>all<span class="w"> </span>-n<span class="w"> </span>argocd<span class="w"> </span>-o<span class="w"> </span>yaml<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-A<span class="w"> </span><span class="m">5</span><span class="w"> </span>finalizers

<span class="c1"># Remove finalizers from specific resource</span>
kubectl<span class="w"> </span>patch<span class="w"> </span>&lt;resource-type&gt;<span class="w"> </span>&lt;resource-name&gt;<span class="w"> </span>-n<span class="w"> </span>argocd<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-p<span class="w"> </span><span class="s1">'{"metadata":{"finalizers":[]}}'</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--type<span class="o">=</span>merge
</code></pre></div>
<h3 id="infrastructure-destruction-issues">Infrastructure Destruction Issues<a class="headerlink" href="#infrastructure-destruction-issues" title="Permanent link">¶</a></h3>
<p><strong>Terraform/OpenTofu Errors</strong>:</p>
<ul>
<li><strong>State Lock</strong>: If state is locked, check for other running Terraform processes</li>
<li><strong>Resource Dependencies</strong>: Some resources may have dependencies preventing deletion</li>
<li><strong>Provider Timeouts</strong>: Large resources may take longer than default timeouts</li>
</ul>
<p><strong>Common Solutions</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Force unlock state (use with caution)</span>
tofu<span class="w"> </span>force-unlock<span class="w"> </span>&lt;lock-id&gt;

<span class="c1"># Destroy specific resources first</span>
tofu<span class="w"> </span>destroy<span class="w"> </span>-target<span class="o">=</span>&lt;resource-address&gt;

<span class="c1"># Increase timeout for slow resources</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">TF_CLI_ARGS</span><span class="o">=</span><span class="s2">"-timeout=30m"</span>
tofu<span class="w"> </span>destroy
</code></pre></div>
<p><strong>Resources Not Destroyed</strong>:</p>
<p>Some resources may not be destroyed if:</p>
<ul>
<li>They're managed outside of Terraform</li>
<li>They have deletion protection enabled</li>
<li>They're shared resources used by other clusters</li>
</ul>
<p>Manually remove these resources through the cloud provider console if needed.</p>
<h3 id="kubernetes-cluster-access-issues">Kubernetes Cluster Access Issues<a class="headerlink" href="#kubernetes-cluster-access-issues" title="Permanent link">¶</a></h3>
<p><strong>Cannot Access Cluster During Destruction</strong>:</p>
<ul>
<li>If the cluster API server is already destroyed, you cannot use <code>kubectl</code> commands</li>
<li>Some resources may be destroyed automatically by the cloud provider</li>
<li>Check cloud provider console for remaining resources</li>
</ul>
<p><strong>Orphaned Resources</strong>:</p>
<p>After cluster destruction, some resources may remain:</p>
<ul>
<li>Load balancers</li>
<li>Persistent volumes (if not properly cleaned up)</li>
<li>Security groups</li>
<li>IAM roles and policies</li>
</ul>
<p>Manually clean these up through the cloud provider console.</p>
<h3 id="state-file-issues">State File Issues<a class="headerlink" href="#state-file-issues" title="Permanent link">¶</a></h3>
<p><strong>State File Not Found</strong>:</p>
<ul>
<li>Verify backend configuration is correct</li>
<li>Check that state file exists in the backend storage</li>
<li>Ensure backend credentials have read access</li>
</ul>
<p><strong>State File Corruption</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Backup state file first</span>
tofu<span class="w"> </span>state<span class="w"> </span>pull<span class="w"> </span>&gt;<span class="w"> </span>state-backup.json

<span class="c1"># Try to refresh state</span>
tofu<span class="w"> </span>refresh

<span class="c1"># If refresh fails, you may need to import resources or recreate state</span>
</code></pre></div>
<h3 id="partial-destruction">Partial Destruction<a class="headerlink" href="#partial-destruction" title="Permanent link">¶</a></h3>
<p>If destruction partially succeeds:</p>
<ol>
<li><strong>Review Remaining Resources</strong>: Check what resources still exist</li>
<li><strong>Manual Cleanup</strong>: Remove remaining resources through cloud provider console</li>
<li><strong>Update State</strong>: Use <code>tofu state rm</code> to remove destroyed resources from state</li>
<li><strong>Retry Destruction</strong>: Run <code>tofu destroy</code> again to clean up remaining resources</li>
</ol>
<h3 id="data-recovery">Data Recovery<a class="headerlink" href="#data-recovery" title="Permanent link">¶</a></h3>
<p>If you need to recover data after deprovisioning:</p>
<ul>
<li><strong>Backups</strong>: Check if Velero or other backup solutions created backups</li>
<li><strong>Database Snapshots</strong>: Some cloud providers maintain database snapshots</li>
<li><strong>Storage Buckets</strong>: If buckets weren't destroyed, data may still be accessible</li>
<li><strong>Volume Snapshots</strong>: Check for volume snapshots in your cloud provider</li>
</ul>
<p><strong>Note</strong>: Recovery may not be possible if backups weren't configured or have been deleted.</p>
<h2 id="best-practices">Best Practices<a class="headerlink" href="#best-practices" title="Permanent link">¶</a></h2>
<h3 id="before-deprovisioning">Before Deprovisioning<a class="headerlink" href="#before-deprovisioning" title="Permanent link">¶</a></h3>
<ol>
<li><strong>Create Backups</strong>: Ensure all important data is backed up</li>
<li><strong>Document Configuration</strong>: Save cluster configuration for future reference</li>
<li><strong>Verify Dependencies</strong>: Check that no other systems depend on this infrastructure</li>
</ol>
<h3 id="during-deprovisioning">During Deprovisioning<a class="headerlink" href="#during-deprovisioning" title="Permanent link">¶</a></h3>
<ol>
<li><strong>Follow Order</strong>: Remove instances → Uninstall tools → Destroy infrastructure</li>
<li><strong>Monitor Progress</strong>: Watch for errors and address them promptly</li>
<li><strong>Verify Removal</strong>: Confirm resources are actually destroyed, not just marked for deletion</li>
<li><strong>Keep Logs</strong>: Save logs of the deprovisioning process for troubleshooting</li>
</ol>
<h3 id="after-deprovisioning">After Deprovisioning<a class="headerlink" href="#after-deprovisioning" title="Permanent link">¶</a></h3>
<ol>
<li><strong>Verify Cleanup</strong>: Check cloud provider console for any remaining resources</li>
<li><strong>Update Documentation</strong>: Note that infrastructure has been deprovisioned</li>
<li><strong>Archive Configuration</strong>: Keep cluster configuration in version control for reference</li>
<li><strong>Review Costs</strong>: Verify that cloud provider billing reflects the destroyed resources</li>
</ol>
<h2 id="next-steps">Next Steps<a class="headerlink" href="#next-steps" title="Permanent link">¶</a></h2>
<p>After successfully deprovisioning infrastructure:</p>
<ol>
<li><strong>Verify Billing</strong>: Confirm cloud provider billing reflects destroyed resources</li>
<li><strong>Archive Configuration</strong>: Keep cluster configuration for future reference</li>
<li><strong>Update Documentation</strong>: Document that the cluster has been deprovisioned</li>
<li><strong>Clean Up Credentials</strong>: Rotate or remove any credentials that were used for this cluster</li>
</ol>
<h2 id="related-documentation">Related Documentation<a class="headerlink" href="#related-documentation" title="Permanent link">¶</a></h2>
<ul>
<li><a href="../">Infrastructure Overview</a> -  Core components and architecture</li>
<li><a href="../provisioning/">Provisioning</a> -  How infrastructure is provisioned</li>
<li><a href="../../cluster/">Cluster Overview</a> -  Cluster operations</li>
<li><a href="../../instances/deprovisioning/">Instance Deprovisioning</a> -  Deleting Open edX instances</li>
</ul>
<h2 id="see-also">See Also<a class="headerlink" href="#see-also" title="Permanent link">¶</a></h2>
<ul>
<li><a href="../../cluster/backup/">Cluster Backup</a> -  Backup before deprovisioning</li>
<li><a href="../../cluster/restore/">Cluster Restore</a> -  Restore procedures</li>
<li><a href="../custom-resources/">Custom Resources</a> -  Resources removed during deprovisioning</li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="https://unpkg.com/mermaid@8/dist/mermaid.min.js"></script>
      
    
  
<script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(()=>{ lightbox.reload(); });
</script></body></html>